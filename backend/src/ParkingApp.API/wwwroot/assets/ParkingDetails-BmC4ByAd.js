import{r as l,j as e,A as O,d as W,a as $,u as q,c as b,g as C,h as D}from"./index-BbeuzGPc.js";import{L as F}from"./LocationMap-CpImmEzJ.js";import{s as h}from"./toast-CtpW-G34.js";import"./leaflet-B8HJ1I4N.js";function H({images:i,title:x}){const[m,p]=l.useState(null);if(!i||i.length===0)return e.jsx("div",{className:"parking-image",style:{height:"300px",marginBottom:"1.5rem",fontSize:"5rem",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--color-bg-card)",borderRadius:"var(--radius-md)"},children:"ðŸ…¿ï¸"});const t=n=>{n.stopPropagation(),p(d=>(d+1)%i.length)},k=n=>{n.stopPropagation(),p(d=>(d-1+i.length)%i.length)},j=()=>{p(null)},y=n=>n?n.startsWith("http")?n:`${O}${n}`:"";return e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem"},children:i.map((n,d)=>e.jsx("img",{src:y(n),alt:`${x} - ${d+1}`,style:{width:"100%",height:"150px",objectFit:"cover",borderRadius:"var(--radius-md)",cursor:"pointer",transition:"transform 0.2s"},onClick:()=>p(d),onMouseEnter:o=>o.target.style.transform="scale(1.02)",onMouseLeave:o=>o.target.style.transform="scale(1)",loading:"lazy"},d))}),m!==null&&e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.9)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:j,children:[e.jsx("button",{onClick:j,style:{position:"absolute",top:"20px",right:"20px",background:"transparent",border:"none",color:"white",fontSize:"2rem",cursor:"pointer",padding:"10px",zIndex:2001},children:"Ã—"}),e.jsx("button",{onClick:k,style:{position:"absolute",left:"20px",background:"rgba(255, 255, 255, 0.1)",border:"none",color:"white",fontSize:"2rem",cursor:"pointer",padding:"10px 20px",borderRadius:"50%",transition:"background 0.3s"},onMouseEnter:n=>n.target.style.background="rgba(255, 255, 255, 0.2)",onMouseLeave:n=>n.target.style.background="rgba(255, 255, 255, 0.1)",children:"â€¹"}),e.jsx("img",{src:y(i[m]),alt:`${x} - Full`,style:{maxWidth:"90vw",maxHeight:"90vh",objectFit:"contain",borderRadius:"4px"},onClick:n=>n.stopPropagation()}),e.jsx("button",{onClick:t,style:{position:"absolute",right:"20px",background:"rgba(255, 255, 255, 0.1)",border:"none",color:"white",fontSize:"2rem",cursor:"pointer",padding:"10px 20px",borderRadius:"50%",transition:"background 0.3s"},onMouseEnter:n=>n.target.style.background="rgba(255, 255, 255, 0.2)",onMouseLeave:n=>n.target.style.background="rgba(255, 255, 255, 0.1)",children:"â€º"}),e.jsxs("div",{style:{position:"absolute",bottom:"20px",color:"white",background:"rgba(0,0,0,0.5)",padding:"5px 10px",borderRadius:"15px",fontSize:"0.9rem"},children:[m+1," / ",i.length]})]})]})}const U=["Open","Covered","Garage","Street","Underground"],Y=["Car","Motorcycle","SUV","Truck","Van","Electric"],_=["Hourly","Daily","Weekly","Monthly"],V=["Credit Card","Debit Card","UPI","Net Banking","Wallet","Cash"];function X(){const{id:i}=W(),x=$(),{isAuthenticated:m,user:p}=q(),[t,k]=l.useState(null),[j,y]=l.useState([]),[n,d]=l.useState(!0),[o,T]=l.useState(""),[r,u]=l.useState({startDateTime:"",endDateTime:"",pricingType:0,vehicleType:0,vehicleNumber:"",vehicleModel:"",discountCode:""}),[c,I]=l.useState(null),[f,N]=l.useState(!1),[g,S]=l.useState(null),[R,P]=l.useState(!1),[v,B]=l.useState(null),[w,E]=l.useState(0);l.useEffect(()=>{M()},[i]),l.useEffect(()=>{r.startDateTime&&r.endDateTime&&t&&A()},[r.startDateTime,r.endDateTime,r.pricingType,r.discountCode]);const M=async()=>{try{const s=await b.getParkingById(i);s.success&&s.data?k(s.data):T("Parking space not found");const a=await b.getReviews(i);a.success&&a.data&&y(a.data)}catch{T("Failed to load parking details")}d(!1)},A=async()=>{if(!(!r.startDateTime||!r.endDateTime))try{const s=await b.calculatePrice({parkingSpaceId:i,startDateTime:new Date(r.startDateTime).toISOString(),endDateTime:new Date(r.endDateTime).toISOString(),pricingType:r.pricingType,discountCode:r.discountCode||null});s.success&&s.data&&I(s.data)}catch(s){console.error("Price calculation error:",s)}},z=async s=>{if(s.preventDefault(),!m){x("/login");return}N(!0);try{const a=await b.createBooking({parkingSpaceId:i,startDateTime:new Date(r.startDateTime).toISOString(),endDateTime:new Date(r.endDateTime).toISOString(),pricingType:r.pricingType,vehicleType:r.vehicleType,vehicleNumber:r.vehicleNumber||null,vehicleModel:r.vehicleModel||null,discountCode:r.discountCode||null});a.success&&a.data?(B(a.data),S({reference:a.data.bookingReference,message:"Booking request submitted! Waiting for owner approval.",isPending:!0}),h.success("Booking request submitted! Waiting for owner approval.")):h.error(C(a))}catch(a){h.error(D(a,"Booking failed"))}N(!1)},L=async()=>{N(!0);try{const s=await b.processPayment({bookingId:v.id,paymentMethod:w});s.success&&s.data?.success?(S({reference:v.bookingReference,message:"Payment successful! Your booking is confirmed."}),P(!1),h.success("Payment successful! Your booking is confirmed.")):h.error(C(s.data||s))}catch(s){h.error(D(s,"Payment failed"))}N(!1)};return n?e.jsx("div",{className:"page",children:e.jsx("div",{className:"container loading",children:e.jsx("div",{className:"spinner"})})}):o&&!t?e.jsx("div",{className:"page",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"alert alert-error",children:o})})}):e.jsx("div",{className:"page",children:e.jsxs("div",{className:"container",children:[g&&e.jsxs("div",{className:`alert ${g.isPending?"alert-warning":"alert-success"} mb-2`,style:g.isPending?{background:"rgba(245, 158, 11, 0.15)",borderColor:"#f59e0b"}:{},children:[e.jsx("strong",{children:g.message}),e.jsx("br",{}),"Booking Reference: ",e.jsx("strong",{children:g.reference}),g.isPending&&e.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.9rem"},children:"The parking owner will review your request. Once approved, you can proceed with payment from your bookings page."})]}),e.jsxs("div",{className:"grid",style:{gridTemplateColumns:"1fr 400px",gap:"2rem"},children:[e.jsxs("div",{children:[e.jsx(H,{images:t.imageUrls,title:t.title}),e.jsx("h1",{style:{marginBottom:"0.5rem"},children:t.title}),e.jsxs("div",{className:"parking-location",style:{fontSize:"1.1rem"},children:["ðŸ“ ",t.address,", ",t.city,", ",t.state]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("span",{className:"parking-tag",children:U[t.parkingType]}),e.jsxs("span",{className:"parking-tag",children:[t.totalSpots," Total Spots"]}),e.jsxs("span",{className:"parking-tag",children:[t.availableSpots," Available"]}),t.is24Hours&&e.jsx("span",{className:"parking-tag",children:"24/7"})]}),m&&p?.id!==t.ownerId&&e.jsx("button",{className:"btn btn-secondary mt-2",onClick:()=>x(`/chat?parkingSpaceId=${t.id}`),style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ’¬ Chat with Owner"}),e.jsxs("div",{className:"card mt-3",children:[e.jsx("h3",{className:"card-title",children:"Description"}),e.jsx("p",{children:t.description})]}),e.jsxs("div",{className:"card mt-2",children:[e.jsx("h3",{className:"card-title",children:"Pricing"}),e.jsxs("div",{className:"grid grid-4",style:{marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"stat-value",style:{fontSize:"1.5rem"},children:["â‚¹",t.hourlyRate]}),e.jsx("div",{className:"stat-label",children:"Per Hour"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"stat-value",style:{fontSize:"1.5rem"},children:["â‚¹",t.dailyRate]}),e.jsx("div",{className:"stat-label",children:"Per Day"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"stat-value",style:{fontSize:"1.5rem"},children:["â‚¹",t.weeklyRate]}),e.jsx("div",{className:"stat-label",children:"Per Week"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"stat-value",style:{fontSize:"1.5rem"},children:["â‚¹",t.monthlyRate]}),e.jsx("div",{className:"stat-label",children:"Per Month"})]})]})]}),t.amenities?.length>0&&e.jsxs("div",{className:"card mt-2",children:[e.jsx("h3",{className:"card-title",children:"Amenities"}),e.jsx("div",{className:"flex gap-1 mt-1",style:{flexWrap:"wrap"},children:t.amenities.map(s=>e.jsx("span",{className:"parking-tag",children:s},s))})]}),t.specialInstructions&&e.jsxs("div",{className:"card mt-2",children:[e.jsx("h3",{className:"card-title",children:"Special Instructions"}),e.jsx("p",{children:t.specialInstructions})]}),e.jsxs("div",{className:"card mt-2",children:[e.jsx("h3",{className:"card-title",children:"Location"}),e.jsx("div",{style:{marginTop:"0.75rem"},children:e.jsx(F,{singleLocation:{latitude:t.latitude,longitude:t.longitude,title:t.title},height:"250px"})})]}),e.jsxs("div",{className:"card mt-2",children:[e.jsxs("h3",{className:"card-title",children:["Reviews (",t.totalReviews,")",e.jsxs("span",{className:"rating",style:{marginLeft:"1rem"},children:["â­ ",t.averageRating?.toFixed(1)||"No ratings"]})]}),j.length===0?e.jsx("p",{className:"card-subtitle mt-1",children:"No reviews yet"}):j.map(s=>e.jsxs("div",{style:{borderTop:"1px solid var(--color-border)",paddingTop:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"flex-between",children:[e.jsx("strong",{children:s.userName}),e.jsxs("span",{className:"rating",children:["â­ ",s.rating]})]}),s.title&&e.jsx("p",{style:{fontWeight:500,marginTop:"0.5rem"},children:s.title}),s.comment&&e.jsx("p",{className:"card-subtitle",children:s.comment}),s.ownerResponse&&e.jsxs("div",{style:{background:"var(--color-bg-glass)",padding:"0.75rem",borderRadius:"var(--radius-sm)",marginTop:"0.5rem"},children:[e.jsx("small",{children:"Owner Response:"}),e.jsx("p",{children:s.ownerResponse})]})]},s.id))]})]}),e.jsx("div",{children:R?e.jsxs("div",{className:"booking-summary",children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Complete Payment"}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{children:"Booking Reference"}),e.jsx("strong",{children:v.bookingReference})]}),e.jsxs("div",{className:"price-row total",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{children:["â‚¹",v.totalAmount]})]}),e.jsxs("div",{className:"form-group mt-2",children:[e.jsx("label",{className:"form-label",children:"Payment Method"}),e.jsx("select",{className:"form-select",value:w,onChange:s=>E(parseInt(s.target.value)),children:V.map((s,a)=>e.jsx("option",{value:a,children:s},a))})]}),o&&e.jsx("div",{className:"alert alert-error",children:o}),e.jsx("button",{className:"btn btn-primary btn-full mt-2",onClick:L,disabled:f,children:f?"Processing...":`Pay â‚¹${v.totalAmount}`}),e.jsx("button",{className:"btn btn-secondary btn-full mt-1",onClick:()=>P(!1),children:"Cancel"})]}):e.jsxs("div",{className:"booking-summary",children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Book This Space"}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Start Date & Time"}),e.jsx("input",{type:"datetime-local",className:"form-input",value:r.startDateTime,onChange:s=>u(a=>({...a,startDateTime:s.target.value})),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"End Date & Time"}),e.jsx("input",{type:"datetime-local",className:"form-input",value:r.endDateTime,onChange:s=>u(a=>({...a,endDateTime:s.target.value})),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Pricing Type"}),e.jsx("select",{className:"form-select",value:r.pricingType,onChange:s=>u(a=>({...a,pricingType:parseInt(s.target.value)})),children:_.map((s,a)=>e.jsx("option",{value:a,children:s},a))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Vehicle Type"}),e.jsx("select",{className:"form-select",value:r.vehicleType,onChange:s=>u(a=>({...a,vehicleType:parseInt(s.target.value)})),children:Y.map((s,a)=>e.jsx("option",{value:a,children:s},a))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Vehicle Number (Optional)"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"e.g., MH12AB1234",value:r.vehicleNumber,onChange:s=>u(a=>({...a,vehicleNumber:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Discount Code"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Enter code",value:r.discountCode,onChange:s=>u(a=>({...a,discountCode:s.target.value}))})]}),c&&e.jsxs("div",{style:{borderTop:"1px solid var(--color-border)",paddingTop:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"price-row",children:[e.jsxs("span",{children:["Base (",c.duration," ",c.durationUnit,")"]}),e.jsxs("span",{children:["â‚¹",c.baseAmount]})]}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{children:"Tax (18%)"}),e.jsxs("span",{children:["â‚¹",c.taxAmount]})]}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{children:"Service Fee"}),e.jsxs("span",{children:["â‚¹",c.serviceFee]})]}),c.discountAmount>0&&e.jsxs("div",{className:"price-row",style:{color:"var(--color-success)"},children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-â‚¹",c.discountAmount]})]}),e.jsxs("div",{className:"price-row total",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["â‚¹",c.totalAmount]})]})]}),o&&e.jsx("div",{className:"alert alert-error",children:o}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-full mt-2",disabled:f||!c,children:f?"Submitting Request...":"Request Booking"})]})]})})]})]})})}export{X as default};
