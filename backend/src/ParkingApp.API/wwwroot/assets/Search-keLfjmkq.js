import{b,r,c as S,j as e,L as T,A as P}from"./index-BD1vJQCf.js";import{L as C}from"./LocationMap-T8yHa4rg.js";import{S as R,I as E}from"./indianStatesCities-CpLRmfdt.js";import"./leaflet-BHpfzUxG.js";const p=["Open","Covered","Garage","Street","Underground"],D=["Car","Motorcycle","SUV","Truck","Van","Electric"];function k(){const[u]=b(),[i,v]=r.useState([]),[j,g]=r.useState(!1),[x,d]=r.useState(null),[a,n]=r.useState({state:"",city:u.get("city")||"",address:"",minPrice:"",maxPrice:"",parkingType:"",vehicleType:"",minRating:"",page:1,pageSize:12}),[m,N]=r.useState(1),h=r.useCallback(async s=>{g(!0);try{const c=Object.fromEntries(Object.entries(s||a).filter(([,y])=>y!=="")),o=await S.searchParking(c);o.success&&o.data&&(v(o.data.parkingSpaces||[]),N(o.data.totalPages||1))}catch(l){console.error("Search error:",l)}g(!1)},[a]);r.useEffect(()=>{h()},[]),r.useEffect(()=>{a.page>1&&h()},[a.page]);const f=s=>{s.preventDefault();const l={...a,page:1};n(l),h(l)},t=(s,l)=>{n(c=>({...c,[s]:l}))};return e.jsx("div",{className:"page",children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{style:{marginBottom:"1.5rem"},children:"Find Parking"}),e.jsx("div",{className:"card hover-card mb-3",children:e.jsx("form",{onSubmit:f,children:e.jsxs("div",{className:"grid grid-4",style:{gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"State"}),e.jsxs("select",{className:"form-select",value:a.state,onChange:s=>{n(l=>({...l,state:s.target.value,city:""}))},children:[e.jsx("option",{value:"",children:"Select State"}),R.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"City"}),e.jsxs("select",{className:"form-select",value:a.city,onChange:s=>t("city",s.target.value),disabled:!a.state,children:[e.jsx("option",{value:"",children:"Select City"}),a.state&&E[a.state]?.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Address/Area"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Street or area",value:a.address,onChange:s=>t("address",s.target.value)})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Parking Type"}),e.jsxs("select",{className:"form-select",value:a.parkingType,onChange:s=>t("parkingType",s.target.value),children:[e.jsx("option",{value:"",children:"All Types"}),p.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Vehicle Type"}),e.jsxs("select",{className:"form-select",value:a.vehicleType,onChange:s=>t("vehicleType",s.target.value),children:[e.jsx("option",{value:"",children:"All Vehicles"}),D.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Min Price (â‚¹/hr)"}),e.jsx("input",{type:"number",className:"form-input",placeholder:"0",value:a.minPrice,onChange:s=>t("minPrice",s.target.value)})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Max Price (â‚¹/hr)"}),e.jsx("input",{type:"number",className:"form-input",placeholder:"1000",value:a.maxPrice,onChange:s=>t("maxPrice",s.target.value)})]}),e.jsxs("div",{className:"form-group",style:{margin:0},children:[e.jsx("label",{className:"form-label",children:"Min Rating"}),e.jsxs("select",{className:"form-select",value:a.minRating,onChange:s=>t("minRating",s.target.value),children:[e.jsx("option",{value:"",children:"Any Rating"}),e.jsx("option",{value:"4",children:"4+ Stars"}),e.jsx("option",{value:"3",children:"3+ Stars"}),e.jsx("option",{value:"2",children:"2+ Stars"})]})]}),e.jsx("div",{className:"form-group",style:{margin:0,alignSelf:"flex-end"},children:e.jsx("button",{type:"submit",className:"btn btn-primary btn-full",children:"ðŸ” Search"})})]})})}),e.jsxs("div",{className:"search-split",children:[e.jsx("div",{className:"search-cards",children:j?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):i.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ…¿ï¸"}),e.jsx("h3",{children:"No parking spaces found"}),e.jsx("p",{children:"Try adjusting your search filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"search-results-count mb-1",children:e.jsxs("span",{style:{color:"var(--color-text-muted)",fontSize:"0.9rem"},children:[i.length," parking spot",i.length!==1?"s":""," found"]})}),e.jsx("div",{className:"search-card-list",children:i.map(s=>e.jsx(T,{to:`/parking/${s.id}`,style:{textDecoration:"none",color:"inherit"},onMouseEnter:()=>d(s.id),onMouseLeave:()=>d(null),children:e.jsxs("div",{className:`card parking-card hover-card ${x===s.id?"parking-card-highlighted":""}`,children:[s.imageUrls&&s.imageUrls.length>0?e.jsx("img",{src:s.imageUrls[0].startsWith("http")?s.imageUrls[0]:`${P}${s.imageUrls[0]}`,alt:s.title,className:"parking-image",style:{objectFit:"cover"}}):e.jsx("div",{className:"parking-image",children:"ðŸ…¿ï¸"}),e.jsx("h3",{className:"card-title",children:s.title}),e.jsxs("div",{className:"parking-location",children:["ðŸ“ ",s.address,", ",s.city]}),e.jsxs("div",{className:"flex-between mt-1",children:[e.jsxs("div",{className:"parking-price",children:["â‚¹",s.hourlyRate,e.jsx("span",{children:"/hr"})]}),e.jsxs("div",{className:"rating",children:["â­ ",s.averageRating?.toFixed(1)||"New"]})]}),e.jsxs("div",{className:"parking-meta",children:[e.jsx("span",{className:"parking-tag",children:p[s.parkingType]||"Open"}),e.jsxs("span",{className:"parking-tag",children:[s.availableSpots," spots"]}),s.is24Hours&&e.jsx("span",{className:"parking-tag",children:"24/7"})]}),s.activeReservations&&s.activeReservations.length>0&&e.jsxs("div",{style:{marginTop:"0.75rem",padding:"0.5rem",background:"rgba(239, 68, 68, 0.1)",borderRadius:"var(--radius-sm)",fontSize:"0.8rem"},children:[e.jsx("strong",{style:{color:"#ef4444"},children:"ðŸ”’ Reserved:"}),e.jsxs("ul",{style:{margin:"0.25rem 0 0 1rem",padding:0},children:[s.activeReservations.slice(0,3).map((l,c)=>e.jsxs("li",{style:{color:"var(--color-text-muted)"},children:[new Date(l.startDateTime).toLocaleDateString()," ",new Date(l.startDateTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," â†’ ",new Date(l.endDateTime).toLocaleDateString()," ",new Date(l.endDateTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]},c)),s.activeReservations.length>3&&e.jsxs("li",{style:{color:"var(--color-text-muted)"},children:["+",s.activeReservations.length-3," more reservations"]})]})]})]})},s.id))}),m>1&&e.jsxs("div",{className:"flex-center gap-2 mt-2",children:[e.jsx("button",{className:"btn btn-secondary",disabled:a.page<=1,onClick:()=>n(s=>({...s,page:s.page-1})),children:"â† Previous"}),e.jsxs("span",{children:["Page ",a.page," of ",m]}),e.jsx("button",{className:"btn btn-secondary",disabled:a.page>=m,onClick:()=>n(s=>({...s,page:s.page+1})),children:"Next â†’"})]})]})}),e.jsx("div",{className:"search-map",children:e.jsx(C,{parkingSpaces:i,height:"100%",highlightedId:x,onMarkerHover:d})})]})]})})}export{k as default};
